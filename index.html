<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sections 1–16 - TeX in C</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Part 1: Introduction</li><li class="chapter-item expanded "><a href="part01.html" class="active">Sections 1–16</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 2: The character set</li><li class="chapter-item expanded "><a href="part02.html">Sections 17–24</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 3: Input and output</li><li class="chapter-item expanded "><a href="part03.html">Sections 25–37</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 4: String handling</li><li class="chapter-item expanded "><a href="part04.html">Sections 38–53</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 5: On-line and off-line printing</li><li class="chapter-item expanded "><a href="part05.html">Sections 54–71</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 6: Reporting errors</li><li class="chapter-item expanded "><a href="part06.html">Sections 72–98</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 7: Arithmetic</li><li class="chapter-item expanded "><a href="part07.html">Sections 99–109</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 8: Packed data</li><li class="chapter-item expanded "><a href="part08.html">Sections 110–114</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 9: Dynamic memory allocation</li><li class="chapter-item expanded "><a href="part09.html">Sections 115–132</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 10: Data structures for boxes and their friends</li><li class="chapter-item expanded "><a href="part10.html">Sections 133–161</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 11: Memory layout</li><li class="chapter-item expanded "><a href="part11.html">Sections 162–172</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 12: Displaying boxes</li><li class="chapter-item expanded "><a href="part12.html">Sections 173–198</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 13: Destroying boxes</li><li class="chapter-item expanded "><a href="part13.html">Sections 199–202</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 14: Copying boxes</li><li class="chapter-item expanded "><a href="part14.html">Sections 203–206</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 15: The command codes</li><li class="chapter-item expanded "><a href="part15.html">Sections 207–210</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 16: The semantic nest</li><li class="chapter-item expanded "><a href="part16.html">Sections 211–219</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 17: The table of equivalents</li><li class="chapter-item expanded "><a href="part17.html">Sections 220–255</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 18: The hash table</li><li class="chapter-item expanded "><a href="part18.html">Sections 256–267</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 19: Saving and restoring equivalents</li><li class="chapter-item expanded "><a href="part19.html">Sections 268–288</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 20: Token lists</li><li class="chapter-item expanded "><a href="part20.html">Sections 289–296</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 21: Introduction to the syntactic routines</li><li class="chapter-item expanded "><a href="part21.html">Sections 297–299</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 22: Input stacks and states</li><li class="chapter-item expanded "><a href="part22.html">Sections 300–320</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 23: Maintaining the input stacks</li><li class="chapter-item expanded "><a href="part23.html">Sections 321–331</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 24: Getting the next token</li><li class="chapter-item expanded "><a href="part24.html">Sections 332–365</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 25: Expanding the next token</li><li class="chapter-item expanded "><a href="part25.html">Sections 336–401</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 26: Basic scanning subroutines</li><li class="chapter-item expanded "><a href="part26.html">Sections 402–463</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 27: Building token lists</li><li class="chapter-item expanded "><a href="part27.html">Sections 464–486</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 28: Conditional processing</li><li class="chapter-item expanded "><a href="part28.html">Sections 487–510</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 29: File names</li><li class="chapter-item expanded "><a href="part29.html">Sections 511–538</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 30: Font metric data</li><li class="chapter-item expanded "><a href="part30.html">Sections 539–582</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 31: Device-independent file format</li><li class="chapter-item expanded "><a href="part31.html">Sections 583–591</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 32: Shipping pages out</li><li class="chapter-item expanded "><a href="part32.html">Sections 592–643</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 33: Packaging</li><li class="chapter-item expanded "><a href="part33.html">Sections 644–679</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 34: Data structures for math mode</li><li class="chapter-item expanded "><a href="part34.html">Sections 680–698</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 35: Subroutines for math mode</li><li class="chapter-item expanded "><a href="part35.html">Sections 699–718</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 36: Typesetting math formulas</li><li class="chapter-item expanded "><a href="part36.html">Sections 719–767</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 37: Alignment</li><li class="chapter-item expanded "><a href="part37.html">Sections 768–812</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 38: Breaking paragraphs into lines</li><li class="chapter-item expanded "><a href="part38.html">Sections 813–861</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 39: Breaking paragraphs into lines, continued</li><li class="chapter-item expanded "><a href="part39.html">Sections 862–890</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 40: Pre-hyphenation</li><li class="chapter-item expanded "><a href="part40.html">Sections 891–899</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 41: Post-hyphenation</li><li class="chapter-item expanded "><a href="part41.html">Sections 900–918</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 42: Hyphenation</li><li class="chapter-item expanded "><a href="part42.html">Sections 919–941</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 43: Initializing the hyphenation tables</li><li class="chapter-item expanded "><a href="part43.html">Sections 942–966</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 44: Breaking vertical lists into pages</li><li class="chapter-item expanded "><a href="part44.html">Sections 967–979</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 45: The page builder</li><li class="chapter-item expanded "><a href="part45.html">Sections 980–1028</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 46: The chief executive</li><li class="chapter-item expanded "><a href="part46.html">Sections 1029–1054</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 47: Building boxes and lists</li><li class="chapter-item expanded "><a href="part47.html">Sections 1055–1135</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 48: Building math lists</li><li class="chapter-item expanded "><a href="part48.html">Sections 1136–1207</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 49: Mode-independent processing</li><li class="chapter-item expanded "><a href="part49.html">Sections 1208–1298</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 50: Dumping and undumping the tables</li><li class="chapter-item expanded "><a href="part50.html">Sections 1299–1329</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 51: The main program</li><li class="chapter-item expanded "><a href="part51.html">Sections 1330–1337</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 52: Debugging</li><li class="chapter-item expanded "><a href="part52.html">Sections 1338–1339</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 53: Extensions</li><li class="chapter-item expanded "><a href="part53.html">Sections 1340–1378</a></li><li class="chapter-item expanded affix "><li class="part-title">Part 54: System-dependent changes</li><li class="chapter-item expanded "><a href="part54.html">Sections 1379–1383</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">TeX in C</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="section-1-introduction"><a class="header" href="#section-1-introduction">Section 1: Introduction</a></h1>
<p>This is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>, a document compiler intended to produce typesetting of high quality.
The Pascal program that follows is the definition of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span><span class="mord">82</span></span></span></span>, a standard version of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> that is designed to be highly portable so that identical output will be obtainable on a great variety of computers.</p>
<p>The main purpose of the following program is to explain the algorithms of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> as clearly as possible.
As a result, the program will not necessarily be very efficient when a particular Pascal compiler has translated it into a particular machine language.
However, the program has been written so that it can be tuned to run efficiently in a wide variety of operating environments by making comparatively few changes.
Such flexibility is possible because the documentation that follows is written in the <code>WEB</code> language, which is at a higher level than Pascal;
the preprocessing step that converts <code>WEB</code> to Pascal is able to introduce most of the necessary refinements.
Semi-automatic translation to other languages is also feasible, because the program below does not make extensive use of features that are peculiar to Pascal.</p>
<p>A large piece of software like <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> has inherent complexity that cannot be reduced below a certain level of difficulty, although each individual part is fairly simple by itself.
The <code>WEB</code> language is intended to make the algorithms as readable as possible, by reflecting the way the individual program pieces fit together and by providing the cross-references that connect different parts.
Detailed comments about what is going on, and about why things were done in certain ways, have been liberally sprinkled throughout the program.
These comments explain features of the implementation, but they rarely attempt to explain the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> language itself, since the reader is supposed to be familiar with <em>The TeXbook</em>.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>Donald Knuth is the author of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>.
The commentaries outside of these notes are the original from <em><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord text"><span class="mord textrm textit">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm textit">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm textit">X</span></span></span></span></span></span>: The Program</em> (with minor modifications such as constants written in uppercases, but the original text stays unchanged).</p>
<p>The code is a conversion from Pascal into C mostly based on the automatic conversion tool <a href="https://hint.userweb.mwn.de/hint/web2w.html">WEB to cweb</a> by Martin Ruckert, with custom adjustments (most of them is the format, and a lot of braces added for conditions followed by a single instruction for example).</p>
<p>It uses Markdown instead of <code>WEB</code> to write the documentation and the code in fenced blocks.
Thanks to mdBook, it is rendered as web pages, and a Python script is used to convert this in compilable code.
More details are given in the <a href="https://github.com/arusson/tex-c">README</a>.</p>
</blockquote>
</div>
<h1 id="section-2"><a class="header" href="#section-2">Section 2</a></h1>
<p>The present implementation has a long ancestry, beginning in the summer of 1977, when Michael F. Plass and Frank M. Liang designed and coded a prototype based on some specifications that the author had made in May of that year.
This original proto<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> included macro definitions and elementary manipulations on boxes and glue, but it did not have line-breaking, page-breaking, mathematical formulas, alignment routines, error recovery, or the present semantic nest; furthermore, it used character lists instead of token lists, so that a control sequence like <code>\halign</code> was represented by a list of seven characters.
A complete version of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> was designed and coded by the author in late 1977 and early 1978; that program, like its prototype, was written in the SAIL language, for which an excellent debugging system was available.
Preliminary plans to convert the SAIL code into a form somewhat like the present “web” were developed by Luis Trabb Pardo and the author at the beginning of 1979, and a complete implementation was created by Ignacio A. Zabala in 1979 and 1980.
The <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span><span class="mord">82</span></span></span></span> program, which was written by the author during the latter part of 1981 and the early part of 1982, also incorporates ideas from the 1979 implementation of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> in MESA that was written by Leonidas Guibas, Robert Sedgewick, and Douglas Wyatt at the Xerox Palo Alto Research Center.
Several hundred refinements were introduced into <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span><span class="mord">82</span></span></span></span> based on the experiences gained with the original implementations, so that essentially every part of the system has been substantially improved.
After the appearance of “Version 0” in September 1982, this program benefited greatly from the comments of many other people, notably David R. Fuchs and Howard W. Trickey.
A final revision in September 1989 extended the input character set to eight-bit codes and introduced the ability to hyphenate words from different languages, based on some ideas of Michael J. Ferguson.</p>
<p>No doubt there still is plenty of room for improvement, but the author is firmly committed to keeping <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span><span class="mord">82</span></span></span></span> “frozen” from now on; stability and reliability are to be its main virtues.</p>
<p>On the other hand, the <code>WEB</code> description can be extended without changing the core of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span><span class="mord">82</span></span></span></span> itself, and the program has been designed so that such extensions are not extremely difficult to make.
The <em>BANNER</em> string defined here should be changed whenever <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> undergoes any modifications, so that it will be clear which version of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> might be the guilty party when a problem arises.</p>
<p>If this program is changed, the resulting system should not be called ‘<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’; the official name ‘<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’ by itself is reserved for software systems that are fully compatible with each other.
A special test suite called the “<code>TRIP</code> test” is available for helping to determine whether a particular implementation deserves to be known as ‘<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’ [cf. Stanford Computer Science report CS1027, November 1984].</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>Constants are written in capital letters.</p>
<p>This C implementation passes the <code>TRIP</code> test, and did not change anything of the core of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> so it can be called <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>.</p>
</blockquote>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">constants.h</div>
<pre><code class="language-c">// &lt;&lt; Start file |constants.h|, 1381 &gt;&gt;

#define BANNER "This is TeX, Version 3.141592653" // printed when TeX starts
</code></pre>
</div>
<h1 id="section-3"><a class="header" href="#section-3">Section 3</a></h1>
<p>Different Pascal s have slightly different conventions, and the present program expresses <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> in terms of the Pascal that was available to the author in 1982.
Constructions that apply to this particular compiler, which we shall call Pascal-H, should help the reader see how to make an appropriate interface for other systems if necessary.
(Pascal-H is Charles Hedrick’s modification of a compiler for the DECsystem-10 that was originally developed at the University of Hamburg; cf. <em>Software—Practice and Experience</em> <strong>6</strong> (1976), 29–42.
The <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> program below is intended to be adaptable, without extensive changes, to most other versions of Pascal, so it does not fully use the admirable features of Pascal-H.
Indeed, a conscious effort has been made here to avoid using several idiosyncratic features of standard Pascal itself, so that most of the code can be translated mechanically into other high-level languages.
For example, the ‘<strong>with</strong>’ and <em>‘new’</em> features are not used, nor are pointer types, set types, or enumerated scalar types; there are no ‘<strong>var</strong>’ parameters, except in the case of files; there are no tag fields on variant records; there are no assignments <em>real ← integer</em>; no procedures are declared local to other procedures.)</p>
<p>The portions of this program that involve system-dependent code, where changes might be necessary because of differences between Pascal compilers and/or differences between operating systems, can be identified by looking at the sections whose numbers are listed under ‘system dependencies’ in the index.
Furthermore, the index entries for ‘dirty Pascal’ list all places where the restrictions of Pascal have not been followed perfectly, for one reason or another.</p>
<p>Incidentally, Pascal’s standard <em>round</em> function can be problematical, because it disagrees with the IEEE floating-point standard. Many implementors have therefore chosen to substitute their own home-grown rounding procedure.</p>
<h1 id="section-4"><a class="header" href="#section-4">Section 4</a></h1>
<p>The program begins with a normal Pascal program heading, whose components will be filled in later, using the conventions of <code>WEB</code>.
For example, the portion of the program called ‘⟨ Global variables, 13 ⟩’ below will be replaced by a sequence of variable declarations that starts in <a href="./part01#section-13">Section 13</a> of this documentation.
In this way, we are able to define each individual global variable when we are prepared to understand what it means; we do not have to define all of the globals at once.
Cross references in section <a href="./part01.html#section-13">13</a>, where it says “See also
sections 26, 30, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.123em;"></span><span class="minner">…</span></span></span></span>”, also make it possible to look at the set of all global variables, if desired.
Similar remarks apply to the other portions of the program heading.</p>
<p>Actually the heading shown here is not quite normal:
The <strong>program</strong> line does not mention any <em>output</em> file, because Pascal-H would ask the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> user to specify a file name if <em>output</em> were specified here.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>A few named blocks are not needed:</p>
<ul>
<li>⟨ Compiler directives 9 ⟩;</li>
<li>⟨ Label in the outer block 6 ⟩.</li>
</ul>
<p>Also, other named blocks are removed and replaced by a filename.
Here, for example:</p>
<ul>
<li>⟨ Constants in the outer block 11 ⟩: in header file <code>constants.h</code>;</li>
<li>⟨ Types in the outer block 18 ⟩: in <code>tex.h</code>;</li>
<li>⟨ Global variables, 13 ⟩: in <code>global.c</code> (variables are declared <code>extern</code> in <code>tex.h</code>, see section <a href="./part54.html#section-1380">1380</a>);</li>
<li>⟨ Basic printing procedures 57 ⟩: in <code>basic_printing.c</code>;</li>
<li>⟨ Error handling procedures 78 ⟩: in <code>error.c</code>.</li>
</ul>
<p>The same happens for others later.</p>
</blockquote>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">tex.h</div>
<pre><code class="language-c">// &lt;&lt; Start file |tex.h|, 1381 &gt;&gt;

// &lt;&lt; Types in the outer block, 18 &gt;&gt;
</code></pre>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">global.c</div>
<pre><code class="language-c">// &lt;&lt; Start file |global.c|, 1382 &gt;&gt;

// &lt;&lt; Global variables, 13 &gt;&gt;
</code></pre>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">init_cleanup.c</div>
<pre><code class="language-c">// &lt;&lt; Start file |init_cleanup.c|, 1382 &gt;&gt;

void initialize() {
    // &lt;&lt; Local variables for initialization, 19 &gt;&gt;
    // &lt;&lt; Initialize whatever TeX might access, 8 &gt;&gt;
}
</code></pre>
</div>
<h1 id="section-5"><a class="header" href="#section-5">Section 5</a></h1>
<p>The overall <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> program begins with the heading just shown, after which comes a bunch of procedure declarations and function declarations.
Finally we will get to the main program, which begins with the comment <em>‘start_here’</em>.
If you want to skip down to the main program now, you can look up <em>‘start_here’</em> in the index.
But the author suggests that the best way to understand this program is to follow pretty much the order of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’s components as they appear in the <code>WEB</code> description you are now reading, since the present ordering is intended to combine the advantages of the “bottom up” and “top down” approaches to the problem of understanding a somewhat complicated system.</p>
<h1 id="section-6"><a class="header" href="#section-6">Section 6</a></h1>
<p>Three labels must be declared in the main program, so we give them symbolic names.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>No need to declare labels,  only local labels (such as <code>found</code> will be declared when needed).</p>
</blockquote>
</div>
<h1 id="section-7"><a class="header" href="#section-7">Section 7</a></h1>
<p>Some of the code below is intended to be used only when diagnosing the strange behavior that sometimes occurs when <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> is being installed or when system wizards are fooling around with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> without quite knowing what they are doing.
Such code will not normally be compiled; it is delimited by the codewords ‘<strong>debug</strong> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.123em;"></span><span class="minner">…</span></span></span></span> <strong>gubed</strong>’, with apologies to people who wish to preserve the purity of English.</p>
<p>Similarly, there is some conditional code delimited by ‘<strong>stat</strong> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.123em;"></span><span class="minner">…</span></span></span></span> <strong>tats</strong>’ that is intended for use when statistics are to be kept about <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’s memory usage.
The <strong>stat</strong> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.123em;"></span><span class="minner">…</span></span></span></span> <strong>tats</strong> code also implements diagnostic information for <code>\tracingparagraphs</code>, <code>\tracingpages</code>, and <code>\tracingrestores</code>.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>Macro preprocessor<code>#ifdef</code> is used to define those blocks:</p>
<ul>
<li><code>#ifdef DEBUG</code> for <strong>debug</strong>;</li>
<li><code>#ifdef STAT</code> for <strong>stat</strong>;</li>
<li>The closing is only <code>#endif</code>.
The flags <code>-DDEBUG</code> and <code>-DSTAT</code> can be used to activate them at compilation time (see the <a href="./part53.html#section-1383">Makefile</a>).</li>
</ul>
</blockquote>
</div>
<h1 id="section-8"><a class="header" href="#section-8">Section 8</a></h1>
<p>This program has two important variations:
(1) There is a long and slow version called <code>INITEX</code>, which does the extra calculations needed to initialize <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’s internal tables;
and (2) there is a shorter and faster production version, which cuts the initialization to a bare minimum.
Parts of the program that are needed in (1) but not in (2) are delimited by the codewords ‘<strong>init</strong> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.123em;"></span><span class="minner">…</span></span></span></span> <strong>tini</strong>’.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>The specific code for <code>INITEX</code> is inside block <code>#ifdef INIT</code>.</p>
</blockquote>
</div>
<div class="blockcode">
<div class="blockcode-header-bname">
<p>⟨ Initialize whatever TeX might access <a href="./part01.html#section-8">8</a> ⟩≡</p>
</div>
<pre><code class="language-c">// &lt;&lt; Set initial values of key variables, 21 &gt;&gt;
#ifdef INIT
// &lt;&lt; Initialize table entries (done by INITEX only), 164 &gt;&gt;
#endif
</code></pre>
<div class="blockcode-footer-usedin">
<p>This code is used in section <a href="./part01.html#section-4">4</a>.</p>
</div></div>
<h1 id="section-9"><a class="header" href="#section-9">Section 9</a></h1>
<p>If the first character of a Pascal comment is a dollar sign, Pascal-H treats the comment as a list of “compiler directives” that will affect the translation of this program into machine language.
The directives shown below specify full checking and inclusion of the Pascal debugger when <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> is being debugged, but they cause range checking and other redundant code to be eliminated when the production system is being generated.
Arithmetic overflow will be detected in all cases.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>No ⟨ Compiler directives 9 ⟩.</p>
</blockquote>
</div>
<h1 id="section-10"><a class="header" href="#section-10">Section 10</a></h1>
<p>This <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> implementation conforms to the rules of the <em>Pascal User Manual</em> published by Jensen and Wirth in 1975, except where system-dependent code is necessary to make a useful system program, and except in another respect where such conformity would unnecessarily obscure the meaning and clutter up the code:
We assume that <strong>case</strong> statements may include a default case that applies if no matching label is found.
Thus, we shall use constructions like</p>
<div align="center">
<div style="text-align: left; display: inline-block;">
<p><strong>case</strong> <em>x</em> <strong>of</strong><br>
1: ⟨ code for <em>x</em> = 1 ⟩;<br>
3: ⟨ code for <em>x</em> = 3 ⟩;<br>
<strong>othercases</strong> ⟨ code for <em>x</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span></span></span></span> 1 and <em>x</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span></span></span></span> 3 ⟩<br>
<strong>endcases</strong></p>
</div>
</div>
<p>since most Pascal compilers have plugged this hole in the language by incorporating some sort of default mechanism.
For example, the Pascal-H compiler allows <em>‘others:’</em> as a default label, and other Pascals allow syntaxes like ‘<strong>else</strong>’ or ‘<strong>otherwise</strong>’ or <em>‘otherwise:’</em>, etc.
The definitions of <strong>othercases</strong> and <strong>endcases</strong> should be changed to agree with local conventions.
Note that no semicolon appears before <strong>endcases</strong> in this program, so the definition of <strong>endcases</strong> should include a semicolon if the compiler wants one.
(Of course, if no default mechanism is available, the <strong>case</strong> statements of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> will have to be laboriously extended by listing all remaining cases.
People who are stuck with such Pascals have, in fact, done this, successfully but not happily!)</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>In C, we use <code>switch</code>, with the <em>break</em> keyword to end a case.
Multiple cases can be combined with subsequents <code>case something:</code>.
The default case is <code>default:</code>.</p>
</blockquote>
</div>
<h1 id="section-11"><a class="header" href="#section-11">Section 11</a></h1>
<p>The following parameters can be changed at compile time to extend or reduce <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’s capacity.
They may have different values in <code>INITEX</code> and in production versions of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>Specific values for the <code>TRIP</code> test have been added in blocks <code>#ifdef TRIP</code>.</p>
</blockquote>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">constants.h</div>
<pre><code class="language-c">#ifdef TRIP
#define MEM_MAX         3000
#define MEM_MIN         1
#else
#define MEM_MAX         30000 // greatest index in TeX's internal |mem| array; must be strictly less than |MAX_HALFWORD|; must be equal to |MEM_TOP| in INITEX, otherwise |&gt;= MEM_TOP|
#define MEM_MIN         0     // smallest index in TeX's internal |mem| array; must be |MIN_HALFWORD| or more; must be equal to |MEM_BOT| in INITEX, otherwise |&lt;= MEM_BOT|
#endif

#define BUF_SIZE        200000// maximum number of characters simultaneously present in current lines of open files and in control sequences between \csname and \endcsname; must not exceed |MAX_HALFWORD|

#ifdef TRIP
#define ERROR_LINE      64
#define HALF_ERROR_LINE 32
#define MAX_PRINT_LINE  72
#else
#define ERROR_LINE      72    // width of context lines on terminal error messages 
#define HALF_ERROR_LINE 42    // width of first lines of contexts in terminal error messages; should be between 30 and |ERROR_LINE - 15|
#define MAX_PRINT_LINE  79    // width of longest text lines output; should be at least 60
#endif

#define STACK_SIZE      200   // maximum number of simultaneous input sources
#define MAX_IN_OPEN     6     // maximum number of input files and error insertions that can be going on simultaneously
#define FONT_MAX        75    // maximum internal font number; must not exceed |MAX_QUARTERWORD| and must be at most |FONT_BASE + 256|
#define FONT_MEM_SIZE   20000 // number of words of |font_info| for all fonts
#define PARAM_SIZE      60    // maximum number of simultaneous macro parameters
#define NEST_SIZE       40    // maximum number of semantic levels simultaneously active
#define MAX_STRINGS     3000  // maximum number of strings; must not exceed |MAX_HALFWORD|
#define POOL_SIZE       32000 // maximum number of characters in strings, including all error messages and help texts, and the names of all fonts and control sequences;
#define SAVE_SIZE       600   // space for saving values outside of current group; must be at most |MAX_HALFWORD|
#define TRIE_SIZE       8000  // space for hyphenation patterns; should be larger for INITEX than it is in production versions of TeX
#define TRIE_OP_SIZE    500   // space for "opcodes" in the hyphenation patterns
#define DVI_BUF_SIZE    800   // size of the output buffer; must be a multiple of 8
#define FILE_NAME_SIZE  40    // file names shouldn't be longer than this
</code></pre>
</div>
<h1 id="section-12"><a class="header" href="#section-12">Section 12</a></h1>
<p>Like the preceding parameters, the following quantities can be changed at compile time to extend or reduce <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span>’s capacity.
But if they are changed, it is necessary to rerun the initialization program <code>INITEX</code> to generate new tables for the production <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> program.
One can’t simply make helter-skelter changes to the following constants, since certain rather complex initialization numbers are computed from them.
They are defined here using <code>WEB</code> macros, instead of being put into Pascal’s <strong>const</strong> list, in order to emphasize this distinction.</p>
<div class="blockcode">
<div class="blockcode-header-fname">constants.h</div>
<pre><code class="language-c">#ifdef TRIP
#define MEM_BOT    1
#define MEM_TOP    3000
#else
#define MEM_BOT    0     // smallest index in the |mem| array dumped by INITEX must not be less than |MEM_MIN|
#define MEM_TOP    30000 // largest index in the |mem| array dumped by INITEX; must be substantially larger than |MEM_BOT| and not greater than |MEM_MAX|
#endif

#define FONT_BASE  0     // smallest internal font number; must not be less than |MIN_QUARTERWORD|
#define HASH_SIZE  2100  // maximum number of control sequences; it should be at most about |(MEM_MAX - MEM_MIN)/10|
#define HASH_PRIME 1777  // a prime number equal to about 85% of |HASH_SIZE|
#define HYPH_SIZE  307   // another prime; the number of \hyphenation exceptions
</code></pre>
</div>
<h1 id="section-13"><a class="header" href="#section-13">Section 13</a></h1>
<p>In case somebody has inadvertently made bad settings of the “constants”, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> checks them using a global variable called <em>bad</em>.</p>
<p>This is the first of many sections of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span> where global variables are defined.</p>
<div class="blockcode">
<div class="blockcode-header-bname">
<p>⟨ Global variables <a href="./part01.html#section-13">13</a> ⟩≡</p>
</div>
<pre><code class="language-c">int bad; // is some "constant" wrong?
</code></pre>
<div class="blockcode-footer-seealso">
<p>See also sections <a href="./part03.html#section-26">26</a>, <a href="./part03.html#section-30">30</a>, <a href="./part04.html#section-39">39</a>, <a href="./part05.html#section-54">54</a>, <a href="./part06.html#section-73">73</a>, <a href="./part06.html#section-76">76</a>, <a href="./part06.html#section-79">79</a>, <a href="./part06.html#section-96">96</a>, <a href="./part07.html#section-104">104</a>, <a href="./part09.html#section-115">115</a>, <a href="./part09.html#section-116">116</a>, <a href="./part09.html#section-117">117</a>, <a href="./part09.html#section-118">118</a>, <a href="./part09.html#section-124">124</a>, <a href="./part11.html#section-165">165</a>, <a href="./part12.html#section-173">173</a>, <a href="./part12.html#section-181">181</a>, <a href="./part16.html#section-213">213</a>, <a href="./part17.html#section-246">246</a>, <a href="./part17.html#section-253">253</a>, <a href="./part18.html#section-256">256</a>, <a href="./part19.html#section-271">271</a>, <a href="./part19.html#section-286">286</a>, <a href="./part21.html#section-297">297</a>, <a href="./part22.html#section-301">301</a>, <a href="./part22.html#section-304">304</a>, <a href="./part22.html#section-305">305</a>, <a href="./part22.html#section-308">308</a>, <a href="./part22.html#section-309">309</a>, <a href="./part22.html#section-310">310</a>, <a href="./part24.html#section-333">333</a>, <a href="./part24.html#section-361">361</a>, <a href="./part25.html#section-382">382</a>, <a href="./part25.html#section-387">387</a>, <a href="./part25.html#section-388">388</a>, <a href="./part26.html#section-410">410</a>, <a href="./part26.html#section-438">438</a>, <a href="./part26.html#section-447">447</a>, <a href="./part27.html#section-480">480</a>, <a href="./part28.html#section-489">489</a>, <a href="./part28.html#section-493">493</a>, <a href="./part29.html#section-512">512</a>, <a href="./part29.html#section-513">513</a>, <a href="./part29.html#section-520">520</a>, <a href="./part29.html#section-527">527</a>, <a href="./part29.html#section-532">532</a>, <a href="./part30.html#section-539">539</a>, <a href="./part30.html#section-549">549</a>, <a href="./part30.html#section-550">550</a>, <a href="./part30.html#section-555">555</a>, <a href="./part32.html#section-592">592</a>, <a href="./part32.html#section-595">595</a>, <a href="./part32.html#section-605">605</a>, <a href="./part32.html#section-616">616</a>, <a href="./part33.html#section-646">646</a>, <a href="./part33.html#section-647">647</a>, <a href="./part33.html#section-661">661</a>, <a href="./part34.html#section-684">684</a>, <a href="./part36.html#section-719">719</a>, <a href="./part36.html#section-724">724</a>, <a href="./part37.html#section-770">770</a>, <a href="./part38.html#section-814">814</a>, <a href="./part38.html#section-821">821</a>, <a href="./part38.html#section-823">823</a>, <a href="./part38.html#section-825">825</a>, <a href="./part38.html#section-828">828</a>, <a href="./part38.html#section-833">833</a>, <a href="./part38.html#section-839">839</a>, <a href="./part38.html#section-847">847</a>, <a href="./part39.html#section-872">872</a>, <a href="./part40.html#section-892">892</a>, <a href="./part41.html#section-900">900</a>, <a href="./part41.html#section-905">905</a>, <a href="./part41.html#section-907">907</a>, <a href="./part42.html#section-921">921</a>, <a href="./part42.html#section-926">926</a>, <a href="./part43.html#section-943">943</a>, <a href="./part43.html#section-947">947</a>, <a href="./part43.html#section-950">950</a>, <a href="./part44.html#section-971">971</a>, <a href="./part45.html#section-980">980</a>, <a href="./part45.html#section-982">982</a>, <a href="./part45.html#section-989">989</a>, <a href="./part46.html#section-1032">1032</a>, <a href="./part47.html#section-1074">1074</a>, <a href="./part49.html#section-1266">1266</a>, <a href="./part49.html#section-1281">1281</a>, <a href="./part50.html#section-1299">1299</a>, <a href="./part50.html#section-1305">1305</a>, <a href="./part53.html#section-1342">1342</a>, and <a href="./part53.html#section-1345">1345</a>.</p>
</div><div class="blockcode-footer-usedin">
<p>This code is used in section <a href="./part01.html#section-4">4</a>.</p>
</div></div>
<h1 id="section-14"><a class="header" href="#section-14">Section 14</a></h1>
<p>Later on we will say ‘<strong>if</strong> <em>MEM_MAX</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span> <em>MAX_HALFWORD</em> <strong>then</strong> <em>bad</em> ← 14’, or something similar.
(We can’t do that until <em>MAX_HALFWORD</em> has been defined.)</p>
<div class="blockcode">
<div class="blockcode-header-bname">
<p>⟨ Check the “constant” values for consistency <a href="./part01.html#section-14">14</a> ⟩≡</p>
</div>
<pre><code class="language-c">bad = 0;
if (HALF_ERROR_LINE &lt; 30 || HALF_ERROR_LINE &gt; ERROR_LINE - 15) {
    bad = 1;
}
if (MAX_PRINT_LINE &lt; 60) {
    bad = 2;
}
if (DVI_BUF_SIZE % 8 != 0) {
    bad = 3;
}
if (MEM_BOT + 1100 &gt; MEM_TOP) {
    bad = 4;
}
if (HASH_PRIME &gt; HASH_SIZE) {
    bad = 5;
}
if (MAX_IN_OPEN &gt;= 128) {
    bad = 6;
}
if (MEM_TOP &lt; 256 + 11) {
    bad = 7; // we will want |NULL_LIST &gt; 255|
}
</code></pre>
<div class="blockcode-footer-seealso">
<p>See also sections <a href="./part08.html#section-111">111</a>, <a href="./part20.html#section-290">290</a>, <a href="./part29.html#section-522">522</a>, and <a href="./part49.html#section-1249">1249</a>.</p>
</div><div class="blockcode-footer-usedin">
<p>This code is used in section <a href="./part51.html#section-1332">1332</a>.</p>
</div></div>
<h1 id="section-15"><a class="header" href="#section-15">Section 15</a></h1>
<p>Labels are given symbolic names by the following definitions, so that occasional <strong>goto</strong> statements will be meaningful.
We insert the label <em>‘exit’</em> just before the ‘<strong>end</strong>’ of a procedure in which we have used the ‘<strong>return</strong>’ statement defined below;
the label <em>‘restart’</em> is occasionally used at the very beginning of a procedure;
and the label <em>‘reswitch’</em> is occasionally used just prior to a <strong>case</strong> statement in which some cases change the conditions and we wish to branch to the newly applicable case.
Loops that are set up with the <strong>loop</strong> construction defined below are commonly exited by going to <em>‘done’</em> or to <em>‘found’</em> or to <em>‘not_found’</em>, and they are sometimes repeated by going to <em>‘continue’</em>.
If two or more parts of a subroutine start differently but end up the same, the shared code may be gathered together at <em>‘common_ending’</em>.</p>
<p>Incidentally, this program never declares a label that isn’t actually used, because some fussy Pascal compilers will complain about redundant labels.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p>The use of label <em>‘exit’</em> is replaced directly by a <code>return</code>, except in at least one case.</p>
<p>Sometimes, the label <em>‘done’</em> is replaced by a <code>break</code> when possible.
The position of the label is still given in a comment for information.</p>
<p>The ‘<strong>loop</strong>’ is replaced by <code>while(true)</code>.</p>
<p>Finally, the label <em>‘continue’</em> is called <em>‘continue_lbl’</em> because it is a C keyword, except when it can be used directly as the keyword <code>continue</code>.</p>
</blockquote>
</div>
<h1 id="section-16"><a class="header" href="#section-16">Section 16</a></h1>
<p>Here are some macros for common programming idioms.</p>
<div class="blocknote">
<div class="blocknote-header">NOTE</div>
<blockquote>
<p><em>odd</em> and <em>abs</em> definitions are added here.</p>
</blockquote>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">constants.h</div>
<pre><code class="language-c">#define EMPTY 0 // symbolic name for a null constant
</code></pre>
</div>
<div class="blockcode">
<div class="blockcode-header-fname">tex.h</div>
<pre><code class="language-c">#define incr(X)    (X) += 1   // increase a variable by unity
#define decr(X)    (X) -= 1   // decrease a variable by unity
#define negate(X)  (X) = -(X) // change the sign of a variable
#define do_nothing
#define odd(X)     ((X) &amp; 1)
#define abs(X)     (((X) &gt;= 0) ? (X) : -(X))
</code></pre>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="part02.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="part02.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
